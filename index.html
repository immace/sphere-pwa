<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Sphere</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.webmanifest">
  <!-- можно добавить собственную иконку: <link rel="apple-touch-icon" href="icon-180.png"> -->
  <style>
    html,body {height:100%;margin:0;background:#0a0b0c;color:#e8e8e8;font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu;}
    .topbar{position:fixed;left:0;right:0;top:0;display:flex;gap:8px;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #1b1e22;background:rgba(12,13,14,0.85);backdrop-filter:blur(6px);z-index:2}
    .btn{padding:8px 12px;border:1px solid #2a2e33;border-radius:10px;color:#cfd3d8;background:#121416}
    .btn:active{transform:translateY(1px)}
    .wrap{position:fixed;inset:0;display:flex;flex-direction:column}
    .frame{position:absolute;left:0;right:0;top:52px;bottom:0;border:0;width:100%;height:calc(100% - 52px);background:#000}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:#1b1e22;color:#e8e8e8;padding:10px 14px;border-radius:12px;border:1px solid #2a2e33;display:none}
    .show{display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div style="font-weight:700;letter-spacing:.5px">SPHERE</div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="btn-ip">Показать IP через прокси</button>
        <button class="btn" id="btn-install" title="Добавить на экран Домой">Установить</button>
      </div>
    </div>
    <!-- Рендерим твой интерфейс из sphere.html во фрейм -->
    <iframe class="frame" src="sphere.html" title="Sphere UI"></iframe>
  </div>
  <div class="toast" id="toast"></div>

  <script>
    const PROXY_BASE = "https://my-proxy-cfme.onrender.com/fetch";
    const USER = "student";
    const PASS = "S3cure!123";

    function toast(msg){
      const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'),2000);
    }

    document.getElementById('btn-ip').onclick = async () => {
      try{
        const auth = "Basic " + btoa(USER + ":" + PASS);
        const r = await fetch(PROXY_BASE + "?url=https://api.ipify.org", { headers:{Authorization:auth} });
        const ip = await r.text();
        toast("IP через прокси: " + ip);
        alert("IP через прокси: " + ip);
      }catch(e){ alert("Ошибка: " + e.message); }
    };

    // PWA install (для Android и некоторых случаев на iOS)
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
    document.getElementById('btn-install').onclick = async () => {
      if(deferredPrompt){ deferredPrompt.prompt(); deferredPrompt=null; }
      else alert('На iPhone добавляй через Share → Add to Home Screen (На экран «Домой»).');
    };

    // Регистрация service worker (кеш/offline)
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('./service-worker.js'); }
  </script>
</body>
</html>
